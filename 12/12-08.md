# Домашнее задание к занятию 12.8 "Резервное копирование баз данных"

---

## Задание 1. Резервное копирование

## Кейс
Финансовая компания решила увеличить надежность работы БД и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1 Необходимо восстанавливать данные в полном объеме за предыдущий день.

1.2 Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую/починеную БД?

*Приведите ответ в свободной форме.*  

### Ответ:
```
 1.1  Для этого делаем еженедельный фуллбэкап и инкрементный каждый день  
 
 1.2  Для этого схема копирования подойдет так им образом фуллбэкап еженедельно, инкрементное копирование каждый день и дифференциональное каждый час  
 
 1.3* Да это возможно, если была настроена репликация MASTER-SLAVE.
```
---

## Задание 2. PostgreSQL

2.1 С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

### Ответ:  
```
2.1 **pg_dump имя_базы > файл_базы**. например: **pg_dump testDB > /home/usernamedir/BAKDB.dump**,  

если резервная копия выполняется не от учетной записи ,необходимо добавить **-U** и **-W**, где U юзер, а W пароль  

**pg_dump -U username -W user_pass > /home/usernamedir/BAKDB.dump**  

Восстановление:  

**pg_restore -d имя_базы путь_до_файла. например: pg_restore testDB /home/usernamedir/BAKDB.dump**  
       
2.1* Да можно, если написать скрипт и добавить его исполнение в планировщик *cron*
```
```
создаем для скрипта папку
mkdir /scripts/bacBD.sh  

#!/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin

PGPASSWORD=password
export PGPASSWORD
pathB=/backup
dbUser=dbuser
database=db

find $pathB \( -name "*-1[^5].*" -o -name "*-[023]?.*" \) -ctime +61 -delete
pg_dump -U $dbUser $database | gzip > $pathB/pgsql_$(date "+%Y-%m-%d").sql.gz

unset PGPASSWORD
сохраняем  

создаем задание в планировщике  

crontab -e  
6 0 * * * /scripts/bacBD.sh  
теперь наш скрипт будет запускаться каждый день в 06:00 утра
```
---

## Задание 3. MySql

3.1 С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySql. 

3.1* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

---
